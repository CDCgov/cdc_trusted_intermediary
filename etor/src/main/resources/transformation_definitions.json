{
  "definitions": [ {
      "name": "addEtorProcessingTag",
      "description": "Adds ETOR processing tag to all messages",
      "message": "",
      "conditions": [ ],
      "rules": [
        {
          "name": "AddEtorProcessingTag",
          "args": { }
        }
      ]
    },
    {
      "name": "convertToOmlOrder",
      "description": "Converts an ORM order to OML",
      "message": "",
      "conditions": [
        "Bundle.entry.resource.ofType(MessageHeader).event.code = 'O01'"
      ],
      "rules": [
        {
          "name": "ConvertToOmlOrder",
          "args": { }
        }
      ]
    },
    {
      "name": "addContactSectionToPatientResource",
      "description": "Adds mother's contact section to patient in OML Order",
      "message": "",
      "conditions": [
        "Bundle.entry.resource.ofType(MessageHeader).event.code = 'O21'"
      ],
      "rules": [
        {
          "name": "AddContactSectionToPatientResource",
          "args": { }
        }
      ]
    },
    {
      "name": "ucsdOruUpdateSendingFacilityNamespace",
      "description": "Updates UCSD ORU Sending Facility's Namespace Id (MSH-4) to 'CDPH'. It also removes Universal Id (MSH-4.2) and Universal Id Type (MSH-4.3).",
      "message": "",
      "conditions": [
        "Bundle.entry.resource.ofType(MessageHeader).event.code = 'R01'",
        "Bundle.entry.resource.ofType(MessageHeader).destination.receiver.resolve().identifier.where(extension.value = 'HD.2,HD.3').value = 'UCSD'"
      ],
      "rules": [
        {
          "name": "UpdateSendingFacilityNamespace",
          "args": {
            "name": "CDPH"
          }
        }
      ]
    },
    {
      "name": "ucsdOruUpdateReceivingApplicationNamespace",
      "description": "Updates UCSD ORU Receiving Application's Namespace Id (MSH-5.1) to 'EPIC'. It also removes Universal Id (MSH-5.2) and Universal Id Type (MSH-5.3)",
      "message": "",
      "conditions": [
        "Bundle.entry.resource.ofType(MessageHeader).event.code = 'R01'",
        "Bundle.entry.resource.ofType(MessageHeader).destination.receiver.resolve().identifier.where(extension.value = 'HD.2,HD.3').value = 'UCSD'"
      ],
      "rules": [
        {
          "name": "UpdateReceivingApplicationNamespace",
          "args": {
            "name": "EPIC"
          }
        }
      ]
    },
    {
      "name": "ucsdOruRemoveMessageTypeStructure",
      "description": "Removes UCSD ORU's Message Structure (MSH-9.3) from the Message Type (MSH-9)",
      "message": "",
      "conditions": [
        "Bundle.entry.resource.ofType(MessageHeader).event.code = 'R01'",
        "Bundle.entry.resource.ofType(MessageHeader).destination.receiver.resolve().identifier.where(extension.value = 'HD.2,HD.3').value = 'UCSD'"
      ],
      "rules": [
        {
          "name": "RemoveMessageTypeStructure",
          "args": { }
        }
      ]
    },
    {
      "name": "ucsdOruSwapPlacerOrderAndGroupNumbers",
      "description": "Swaps UCSD ORU's Placer Order Number (ORC-2) and Placer Group Number (ORC-4)",
      "message": "",
      "conditions": [
        "Bundle.entry.resource.ofType(MessageHeader).event.code = 'R01'",
        "Bundle.entry.resource.ofType(MessageHeader).destination.receiver.resolve().identifier.where(extension.value = 'HD.2,HD.3').value = 'UCSD'"
      ],
      "rules": [
        {
          "name": "SwapPlacerOrderAndGroupNumbers",
          "args": { }
        }
      ]
    },
    {
      "name": "ucsdOruRemovePatientIdentifiers",
      "description": "Removes UCSD ORU's Assigning Authority (PID-3.4) and Identifier Type Code (PID-3.5) from Patient Identifier List (PID-3)",
      "message": "",
      "conditions": [
        "Bundle.entry.resource.ofType(MessageHeader).event.code = 'R01'",
        "Bundle.entry.resource.ofType(MessageHeader).destination.receiver.resolve().identifier.where(extension.value = 'HD.2,HD.3').value = 'UCSD'"
      ],
      "rules": [
        {
          "name": "RemovePatientIdentifiers",
          "args": { }
        }
      ]
    },
    {
      "name": "ucsdOruRemovePatientNameTypeCode",
      "description": "Removes UCSD ORU's Name Type Code (PID-5.7) from Patient Name (PID-5)",
      "message": "",
      "conditions": [
        "Bundle.entry.resource.ofType(MessageHeader).event.code = 'R01'",
        "Bundle.entry.resource.ofType(MessageHeader).destination.receiver.resolve().identifier.where(extension.value = 'HD.2,HD.3').value = 'UCSD'"
      ],
      "rules": [
        {
          "name": "RemovePatientNameTypeCode",
          "args": { }
        }
      ]
    },
    {
      "name": "ucsdOruObrOverrides",
      "description": "Overrides the values of Name of Coding System (OBR-4.3) and Alternate Identifier (OBR-4.4) in Universal Type Code (OBR-4)",
      "message": "",
      "conditions": [
        "Bundle.entry.resource.ofType(MessageHeader).event.code = 'R01'",
        "Bundle.entry.resource.ofType(ServiceRequest).code = '54089-8'"
      ],
      "rules": [
        {
          "name": "ObrOverrides",
          "args": {
            "checkValue": "54089-8",
            "codingSystem": "LN",
            "alternateId": "CDPHGSPEAP"
          }
        }
      ]
    }
  ]
}
