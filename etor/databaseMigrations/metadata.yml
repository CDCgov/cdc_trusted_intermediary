databaseChangeLog:
  - changeSet:
      id: 1
      author: jeff.crichlake
      labels: create-type
      context: metadata
      comment: create status type
      changes:
       - sql:
           sql: CREATE TYPE message_status AS ENUM ('PENDING', 'DELIVERED', 'FAILED')
      rollback:
        - sql:
            sql: DROP TYPE message_status

  - changeSet:
      id: 2
      author:  jeff.crichlake
      labels: create-metadata-table
      context: metadata
      comment: create partner metadata table
      changes:
       - createTable:
            tableName: metadata
            columns:
              - column:
                  name: received_message_id
                  type: varchar(40)
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: sent_message_id
                  type: varchar(40)
              - column:
                  name: sender
                  type: varchar(30)
              - column:
                  name: receiver
                  type: varchar(30)
              - column:
                  name: hash_of_order
                  type: varchar(1000)
              - column:
                  name: time_received
                  type: timestamptz
              - column:
                  name: time_delivered
                  type: timestamptz
              - column:
                  name: delivery_status
                  type: message_status
              - column:
                  name: failure_reason
                  type: varchar(1000)

  - changeSet:
      id: 3
      author: samuel.aquino
      labels: update-metadata-table
      context: metadata
      comment: update partner metadata table
      changes:
        - renameColumn:
            columnDataType: varchar(1000)
            oldColumnName: hash_of_order
            newColumnName: hash_of_message
            tableName: metadata
        - addColumn:
            tableName: metadata
            columns:
              - column:
                  name: message_type
                  type: varchar(15)
